#!/bin/bash

# Текущая дата (в формате ГГГГ-ММ-ДД)
current_date=$(date +%Y-%m-%d)

# Проходим по всем файлам в текущей директории, соответствующим шаблону
for file in backup_*_*.*; do
    # Извлекаем дату из имени файла (формат ДД-ММ-ГГГГ)
    file_date=$(echo "$file" | grep -oP '\d{2}-\d{2}-\d{4}')
    
    # Пропускаем файл, если дата не найдена
    if [ -z "$file_date" ]; then
        continue
    fi

    # Преобразуем дату из имени файла в формат ГГГГ-ММ-ДД вручную
    file_date_iso=$(echo "$file_date" | awk -F'-' '{print $3"-"$2"-"$1}')

    # Вычисляем разницу в днях между текущей датой и датой из имени файла
    days_diff=$(( ($(date -d "$current_date" +%s) - $(date -d "$file_date_iso" +%s)) / 86400 )) # Количество секунд в одном дне :)

    # Удаляем файл, если разница больше 7 дней
    if [ $days_diff -gt 7 ]; then
        # echo "Удаляю файл: $file (дата из имени: $file_date, разница: $days_diff дней)"
        rm -v "$file"
    fi
done

echo "Обработка завершена."
