<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TODO –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
    <h1 class="display-4 text-center">Just Do It üëá</h1>

    <div class="row mt-4">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –∏ –ø–æ–∏—Å–∫ -->
        <div class="col-md-6">
            <h3 class="mb-4">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</h3>
            <form id="addTaskForm" method="post" action="/add">
                <div class="mb-3">
                    <label for="title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
                    <input type="text" id="title" name="title" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" required>
                </div>
                <div class="mb-3">
                    <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="description" name="description" class="form-control" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"></textarea>
                </div>
                <button type="submit" class="btn btn-primary w-100">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
            </form>

            <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞—á –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º -->
            <h3 class="mt-5">–ü–æ–∏—Å–∫ –∑–∞–¥–∞—á–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º</h3>
            <form id="searchTaskForm" method="get" action="/search">
                <div class="input-group mb-3">
                    <input type="text" id="query" name="query" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ" required>
                    <button class="btn btn-secondary" type="submit">–ü–æ–∏—Å–∫</button>
                </div>
            </form>
            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞ -->
            {% if search_results is defined %}
            <div class="row mt-5">
                <div class="col-md-12">
                    <h3 class="mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ "{{ search_query }}"</h3>
                    {% if search_results %}
                    {% for task in search_results %}
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5>#{{ task.id }} - {{ task.title }}</h5>
                            <p>{{ task.description }}</p>
                            <p><small>–°–æ–∑–¥–∞–Ω–æ: {{ task.created_at.strftime("%Y-%m-%d %H:%M:%S") }}</small></p>
                            <span class="badge {{ 'bg-success' if task.completed else 'bg-warning text-dark' }}">
                                {{ "–í—ã–ø–æ–ª–Ω–µ–Ω–æ" if task.completed else "–í –ø—Ä–æ—Ü–µ—Å—Å–µ" }}
                            </span>
                            <div class="mt-3">
                                <a href="/edit/{{ task.id }}" class="btn btn-sm btn-info">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                                <button class="btn btn-sm btn-danger delete-button" data-id="{{ task.id }}">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <p class="text-muted">–ó–∞–¥–∞—á–∏ —Å —Ç–∞–∫–∏–º–∏ –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
        <div class="col-md-6">
            <h3 class="mb-4">–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</h3>
            {% if tasks %}
            {% for task in tasks %}
            <div class="card mt-3">
                <div class="card-body">
                    <h5>#{{ task.id }} - {{ task.title }}</h5>
                    <p>{{ task.description }}</p>
                    <p><small>–°–æ–∑–¥–∞–Ω–æ: {{ task.created_at.strftime("%Y-%m-%d %H:%M:%S") }}</small></p>
                    <span class="badge {{ 'bg-success' if task.completed else 'bg-warning text-dark' }}">
                        {{ "–í—ã–ø–æ–ª–Ω–µ–Ω–æ" if task.completed else "–í –ø—Ä–æ—Ü–µ—Å—Å–µ" }}
                    </span>
                    <div class="mt-3">
                        <a href="/edit/{{ task.id }}" class="btn btn-sm btn-info">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <button class="btn btn-sm btn-danger delete-button" data-id="{{ task.id }}">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <p class="text-muted">–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É!</p>
            {% endif %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
    document.querySelectorAll(".delete-button").forEach(button => {
        button.addEventListener("click", async function () {
            const itemId = this.getAttribute("data-id");
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?")) {
                try {
                    const response = await fetch(`/items/${itemId}`, {
                        method: "DELETE",
                        headers: {
                            "Content-Type": "application/json"
                        }
                    });

                    if (response.ok) {
                        alert("–ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.");
                        window.location.reload();
                    } else {
                        const errorData = await response.json();
                        alert(`–û—à–∏–±–∫–∞: ${errorData.detail}`);
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏:", error);
                    alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏.");
                }
            }
        });
    });
</script>
</body>
</html>
